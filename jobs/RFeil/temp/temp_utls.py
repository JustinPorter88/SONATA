
import matplotlib.pyplot as plt
import numpy as np

# chord
chord_grid = [0.0, 0.02, 0.04, 0.06, 0.08, 0.1, 0.12, 0.14, 0.16, 0.18, 0.19938686833333333, 0.21877373666666666, 0.238160605, 0.25754747333333333, 0.27693434166666664, 0.29632121, 0.314930459, 0.333539708, 0.352148957, 0.370758206, 0.38936745500000003, 0.407976704, 0.426585953, 0.445195202, 0.463804451, 0.4824137, 0.5025691128571429, 0.5227245257142857, 0.5428799385714286, 0.5630353514285714, 0.5831907642857144, 0.6033461771428572, 0.62350159, 0.6436570028571429, 0.6638124157142857, 0.6839678285714286, 0.7041232414285714, 0.7242786542857144, 0.7444340671428572, 0.76458948, 0.8, 0.8241168766666667, 0.8482337533333334, 0.87235063, 0.8917629725, 0.9111753149999999, 0.9305876574999999, 0.95, 0.975, 1.0]
chord_values = [4.5, 4.5031530414296626, 4.5216322696862115, 4.564473437026853, 4.62711592537549, 4.704999116656017, 4.793562392792339, 4.888245135708356, 4.984486727327968, 5.0777265495750745, 5.160934254898568, 5.232882233030735, 5.289416577635935, 5.326383382378525, 5.339628740922864, 5.319521657898507, 5.26714412894138, 5.189298218744759, 5.092820331063341, 4.984546869651818, 4.871314238264888, 4.759958840657244, 4.656409744561639, 4.548895054370073, 4.433120112382475, 4.310930182610966, 4.1734906432704335, 4.033034959042285, 3.8919076128106265, 3.752453087459564, 3.6145173124702885, 3.4748721896561237, 3.3337488293755326, 3.191454321568183, 3.048295756173743, 2.9045802231318816, 2.7606148123822676, 2.6168395830719757, 2.4735432233389814, 2.330123978752379, 2.0758813531167415, 1.8995502606607808, 1.7193562191939862, 1.5346773618240344, 1.3833964014428055, 1.229870462547485, 1.0741443511634219, 0.9162628733159686, 0.7098338025894331, 0.5000000000000006]
chord_grid_all = [i*100 +3 for i in chord_grid]


# twist
twist_grid = [0.0, 0.02, 0.04, 0.06, 0.08, 0.1, 0.12, 0.14, 0.16, 0.18, 0.19938686833333333, 0.21877373666666666, 0.238160605, 0.25754747333333333, 0.27693434166666664, 0.29632121, 0.314930459, 0.333539708, 0.352148957, 0.370758206, 0.38936745500000003, 0.407976704, 0.426585953, 0.445195202, 0.463804451, 0.4824137, 0.5025691128571429, 0.5227245257142857, 0.5428799385714286, 0.5630353514285714, 0.5831907642857144, 0.6033461771428572, 0.62350159, 0.6436570028571429, 0.6638124157142857, 0.6839678285714286, 0.7041232414285714, 0.7242786542857144, 0.7444340671428572, 0.76458948, 0.8, 0.8241168766666667, 0.8482337533333334, 0.87235063, 0.8917629725, 0.9111753149999999, 0.9305876574999999, 0.95, 0.975, 1.0]
twist_values = [0.3491, 0.3401097099050312, 0.3281671556909808, 0.31390851768548717, 0.2977930812407983, 0.2802801317091618, 0.2618289544428256, 0.24289883479403748, 0.22394905811504537, 0.20543890975809714, 0.1883497392048554, 0.1725235386099542, 0.158378634678839, 0.14633335411695517, 0.1368060236297482, 0.12919488266720286, 0.12274205204016521, 0.11694814039203379, 0.11163892839985363, 0.1066401967406696, 0.10177772609152669, 0.0968772971294698, 0.09178519002569353, 0.08675247367836557, 0.08187290417655478, 0.0771031217964856, 0.0720106191283443, 0.06694095047600311, 0.0618390255490844, 0.056649754057210545, 0.05142326779994671, 0.04628193757264804, 0.041159217989282716, 0.03598495975820138, 0.030689013587754742, 0.025201230186293447, 0.01945146026216816, 0.013452731628109754, 0.007383007627839853, 0.0011520131215641352, -0.010522825392692618, -0.019264054239721152, -0.028865540145881035, -0.03959878948006779, -0.04925922965220596, -0.05977034858466232, -0.07106399837877751, -0.08307203113589202, -0.09947885389807026, -0.11681192]
twist_values_deg = [i * 180/np.pi for i in twist_values]

# prebend
prebend_grid = [0.0, 0.02, 0.04, 0.06, 0.08, 0.1, 0.12, 0.14, 0.16, 0.18, 0.19938686833333333, 0.21877373666666666, 0.238160605,
       0.25754747333333333, 0.27693434166666664, 0.29632121, 0.314930459, 0.333539708, 0.352148957, 0.370758206,
       0.38936745500000003, 0.407976704, 0.426585953, 0.445195202, 0.463804451, 0.4824137, 0.5025691128571429,
       0.5227245257142857, 0.5428799385714286, 0.5630353514285714, 0.5831907642857144, 0.6033461771428572, 0.62350159,
       0.6436570028571429, 0.6638124157142857, 0.6839678285714286, 0.7041232414285714, 0.7242786542857144,
       0.7444340671428572, 0.76458948, 0.8, 0.8241168766666667, 0.8482337533333334, 0.87235063, 0.8917629725,
       0.9111753149999999, 0.9305876574999999, 0.95, 0.975, 1.0]
prebend_values = [0.0, 0.005454237086148398, 0.018069750174742296, 0.03946845413950356, 0.06792107393769431, 0.10169833452657659,
         0.13907096086341247, 0.17830967790546406, 0.2176852106099934, 0.2554682839342627, 0.288939378431958,
         0.3177142228310246, 0.34021775725224546, 0.35487492181640357, 0.3601106566442823, 0.3559613105340809,
         0.3448797181932704, 0.3278770056748247, 0.3059712710452259, 0.2801806123709562, 0.2515231277184975,
         0.22101691515433203, 0.18924437674049355, 0.14903852094390527, 0.09861371948244461, 0.03937984275800138,
         -0.03307837574309551, -0.11242511734544353, -0.19686908443291795, -0.28461897938939384, -0.37853643207151694,
         -0.4850445316656329, -0.6024898463755582, -0.7290621721125176, -0.8629513047877346, -1.0023470403124346,
         -1.1454391745978412, -1.2924072869247651, -1.4482533124258514, -1.612537456661893, -1.918851510821045,
         -2.1382671239895297, -2.3646360808649267, -2.5980211833914284, -2.7935708882683996, -2.995876778437495,
         -3.2046617586025357, -3.4196487334673424, -3.705206973546146, -3.9999999999999987]


# Plot
font = {'family': 'Times New Roman',
        'weight': 'normal',
        'size': 18}
plt.rc('font', **font)


fig, axes = plt.subplots(3, 1, sharex=True, figsize=(8, 8))



axes[0].plot(chord_grid, chord_values, '-k', linewidth=1.2)
axes[0].grid(True)
axes[0].set(ylabel='Chord length, m')


axes[1].plot(twist_grid, twist_values_deg, '-k', linewidth=1.2)
axes[1].grid(True)
axes[1].set(ylabel='Twist, deg')


axes[2].plot(prebend_grid, prebend_values, '-k', linewidth=1.2)
axes[2].grid(True)
axes[2].set(ylabel='Prebend, m')

axes[2].set(xlabel='r/R')

plt.xlim((0,1.0))
plt.tight_layout()
plt.show(block=True)
fig.savefig('fig_chord_twist_prebend_distributions.png', dpi=300)



pol = np.polyfit(chord_grid_all, chord_values, 6)
plt.plot(chord_grid_all, np.polyval(pol, chord_grid_all), 'k', linewidth=1.2)
#
x = np.round(np.arange(0, 103, 0.05), 2)
plt.plot(x, np.polyval(pol, x), 'c', linewidth=0.8)


import scipy.integrate as integ
y = lambda x: pol[6] + pol[5] * x + pol[4] * x** 2 + pol[3] * x ** 3 + pol[2] * x ** 4 + pol[1] * x ** 5 + pol[0] * x ** 6

chord_surface = integ.quad(y, chord_grid_all[0], chord_grid_all[-1])
blade_disk_area = np.pi * (chord_grid_all[-1]**2 - chord_grid_all[0])
solidity = 3 * chord_surface[0] / blade_disk_area

print('Rotor solidity = ' + str(np.round(solidity, 3)))







